<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image-To-Md-Editor</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">Image-To-Md-Editor</div>
        <div class="navbar-links">
            <a href="#/editor" class="nav-link" data-page="editor">Editor</a>
            <a href="#/browser" class="nav-link" data-page="browser">File Browser</a>
        </div>
    </nav>
    <main>
        <div id="page-editor" class="page">
            <div id="search-bar" class="search-bar hidden">
                <input type="text" id="search-input" placeholder="搜尋所有 Markdown 檔案..." />
                <span id="search-count" class="search-count"></span>
                <button class="btn-icon" id="search-prev" title="上一個 (Shift+Enter)">&#9650;</button>
                <button class="btn-icon" id="search-next" title="下一個 (Enter)">&#9660;</button>
                <button class="btn-icon" id="search-close" title="關閉 (Esc)">&#10005;</button>
            </div>
            <div class="editor-layout">
                <div class="panel panel-left">
                    <div class="panel-toolbar">
                        <button class="btn btn-icon" id="btn-prev" title="上一張">&lt;</button>
                        <span class="toolbar-filename" id="current-filename">—</span>
                        <button class="btn btn-icon" id="btn-next" title="下一張">&gt;</button>
                    </div>
                    <div class="image-preview" id="image-preview">
                        <img id="preview-image" alt="圖片預覽" />
                        <canvas id="crop-overlay"></canvas>
                    </div>
                </div>
                <div class="panel panel-right">
                    <div class="panel-toolbar">
                        <span class="toolbar-filename" id="current-md-filename">—</span>
                        <button class="btn btn-icon" id="btn-save" title="儲存 (Ctrl+S)" disabled>💾</button>
                        <button class="btn btn-icon" id="btn-ocr" title="OCR 文字辨識">🔍</button>
                        <button class="btn btn-icon" id="btn-preview" title="預覽">👁</button>
                    </div>
                    <div class="editor-area">
                        <textarea id="md-editor" placeholder="尚無 Markdown 內容"></textarea>
                        <div id="md-preview" class="md-preview hidden"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="page-browser" class="page">
            <div class="browser-header">
                <h2 class="browser-title">檔案管理</h2>
                <button class="btn-primary" id="btn-upload">📤 上傳圖片</button>
            </div>
            <div class="browser-table-wrap">
                <table class="browser-table">
                    <thead>
                        <tr>
                            <th>檔名</th>
                            <th>類型</th>
                            <th>關聯</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="file-list"></tbody>
                </table>
            </div>

            <!-- 上傳對話框 -->
            <div class="modal-overlay hidden" id="upload-modal">
                <div class="modal">
                    <h3>上傳圖片</h3>
                    <div class="drop-zone" id="drop-zone">
                        拖曳圖片至此處，或 <label class="drop-zone-link">點擊選取<input type="file" id="file-input" accept="image/*" hidden></label>
                    </div>
                    <p class="drop-zone-filename" id="selected-filename"></p>
                    <div class="modal-actions">
                        <button class="btn-secondary" id="upload-cancel">取消</button>
                        <button class="btn-primary" id="upload-confirm" disabled>上傳</button>
                    </div>
                </div>
            </div>

            <!-- 重新命名對話框 -->
            <div class="modal-overlay hidden" id="rename-modal">
                <div class="modal">
                    <h3>重新命名</h3>
                    <p class="modal-hint" id="rename-original"></p>
                    <input type="text" class="modal-input" id="rename-input" />
                    <div class="modal-actions">
                        <button class="btn-secondary" id="rename-cancel">取消</button>
                        <button class="btn-primary" id="rename-confirm">確認</button>
                    </div>
                </div>
            </div>

            <!-- 刪除確認對話框 -->
            <div class="modal-overlay hidden" id="delete-modal">
                <div class="modal">
                    <h3>確認刪除</h3>
                    <p id="delete-message"></p>
                    <label class="modal-checkbox" id="delete-pair-label">
                        <input type="checkbox" id="delete-pair-check" />
                        <span id="delete-pair-text"></span>
                    </label>
                    <div class="modal-actions">
                        <button class="btn-secondary" id="delete-cancel">取消</button>
                        <button class="btn-danger" id="delete-confirm">刪除</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="/static/js/toast.js"></script>
    <script src="/static/js/spinner.js"></script>
    <script src="/static/js/router.js"></script>
    <script src="/static/js/editor.js"></script>
    <script src="/static/js/cropper.js"></script>
    <script src="/static/js/search.js"></script>
    <script src="/static/js/browser.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
